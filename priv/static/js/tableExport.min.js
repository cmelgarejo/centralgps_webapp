(function(f){f.fn.extend({tableExport:function(t){function u(k,e,d,g){f(k).filter(":visible").find(e).each(function(k){if("none"!=f(this).css("display")&&"none"!=f(this).data("tableexport-display")&&-1==a.ignoreColumn.indexOf(k)&&"function"===typeof g){var e=0;if("undefined"!=typeof x[d]&&0<x[d].length)for(c=0;c<=k;c++)"undefined"!=typeof x[d][c]&&(g(null,d,c),delete x[d][c],k++);g(this,d,k);if(f(this).is("[colspan]"))for(e=f(this).attr("colspan"),c=0;c<e-1;c++)g(null,d,k+c);if(f(this).is("[rowspan]")){var b=
parseInt(f(this).attr("rowspan"));for(r=1;r<b;r++)for("undefined"==typeof x[d+r]&&(x[d+r]=[]),x[d+r][k]="",c=1;c<e;c++)x[d+r][k+c]=""}}})}function H(k){!0===a.consoleLog&&console.log(k.output());if("string"==a.outputMode)return k.output();if("base64"==a.outputMode)return y(k.output());try{var e=k.output("blob");saveAs(e,a.fileName+".pdf")}catch(d){z(a.fileName+".pdf","data:application/pdf;base64,"+y(k.output()))}}function I(k,e,d){var g="";if(null!=k)if(e=v(k,e,d),k=null===e||""==e?"":e.toString(),
e instanceof Date)g=a.csvEnclosure+e.toLocaleString()+a.csvEnclosure;else if(e=a.csvEnclosure+a.csvEnclosure,g=k.replace(new RegExp(a.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),e),0<=g.indexOf(a.csvSeparator)||/[\r\n ]/g.test(g))g=a.csvEnclosure+g+a.csvEnclosure;return g}function v(k,e,d){var g="";null!=k&&(k=f(k),g=!0===a.htmlContent?k.html().trim():k.text().trim().replace(/\u00AD/g,""),!0===a.escape&&(g=escape(g)),"function"===typeof a.onCellData&&(g=a.onCellData(k,e,d,g)));
return g}function O(a,e,d){return e+"-"+d.toLowerCase()}function A(a,e){try{return window.getComputedStyle?(e=e.replace(/([a-z])([A-Z])/,O),window.getComputedStyle(a,null).getPropertyValue(e)):a.currentStyle?a.currentStyle[e]:a.style[e]}catch(d){}return""}function G(a,e,d){e=A(a,e).match(/\d+/);if(null!==e){e=e[0];var g=document.createElement("div");g.style.overflow="hidden";g.style.visibility="hidden";a.parentElement.appendChild(g);g.style.width=100+d;d=100/g.offsetWidth;a.parentElement.removeChild(g);
return e*d}return 0}function z(a,e){var d=document.createElement("a");if(d){document.body.appendChild(d);d.style="display: none";d.download=a;d.href=e;if(document.createEvent)null==D&&(D=document.createEvent("MouseEvents")),D.initEvent("click",!0,!1),d.dispatchEvent(D);else if(document.createEventObject)d.fireEvent("onclick");else if("function"==typeof d.onclick)d.onclick();document.body.removeChild(d)}}function y(a){var e="",d,g,b,f,h,m,l=0;a=a.replace(/\x0d\x0a/g,"\n");g="";for(b=0;b<a.length;b++)f=
a.charCodeAt(b),128>f?g+=String.fromCharCode(f):(127<f&&2048>f?g+=String.fromCharCode(f>>6|192):(g+=String.fromCharCode(f>>12|224),g+=String.fromCharCode(f>>6&63|128)),g+=String.fromCharCode(f&63|128));for(a=g;l<a.length;)d=a.charCodeAt(l++),g=a.charCodeAt(l++),b=a.charCodeAt(l++),f=d>>2,d=(d&3)<<4|g>>4,h=(g&15)<<2|b>>6,m=b&63,isNaN(g)?h=m=64:isNaN(b)&&(m=64),e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m);return e}var a={csvSeparator:",",csvEnclosure:'"',consoleLog:!1,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8,
tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},onCellData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"},D=null,x=[];f.extend(!0,a,t);if("csv"==a.type||"txt"==a.type){var p="",n=0;f(this).find("thead").first().find(a.theadSelector).each(function(){trData="";u(this,"th,td",n,function(k,e,d){trData+=I(k,e,d)+a.csvSeparator});trData=f.trim(trData).substring(0,trData.length-1);0<trData.length&&
(0<p.length&&(p+="\n"),p+=trData);n++});f(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";u(this,"td",n,function(k,e,d){trData+=I(k,e,d)+a.csvSeparator});trData=f.trim(trData).substring(0,trData.length-1);0<trData.length&&(0<p.length&&(p+="\n"),p+=trData);n++});p+="\n";!0===a.consoleLog&&console.log(p);if("string"===a.outputMode)return p;if("base64"===a.outputMode)return y(p);try{var w=new Blob([("csv"==a.type?"\ufeff":"")+p],{type:"text/"+("csv"==a.type?"csv":"plain")+
";charset=utf-8"});saveAs(w,a.fileName+"."+a.type)}catch(P){z(a.fileName+"."+a.type,"data:text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8,"+("csv"==a.type?"\ufeff":"")+encodeURIComponent(p))}}else if("sql"==a.type){var n=0,m="INSERT INTO `"+a.tableName+"` (";f(this).find("thead").first().find(a.theadSelector).each(function(){u(this,"th,td",n,function(a,e,d){m+="'"+v(a,e,d)+"',"});n++;m=f.trim(m);m=f.trim(m).substring(0,m.length-1)});m+=") VALUES ";f(this).find("tbody").first().find(a.tbodySelector).each(function(){trData=
"";u(this,"td",n,function(a,e,d){trData+="'"+v(a,e,d)+"',"});3<trData.length&&(m+="("+trData,m=f.trim(m).substring(0,m.length-1),m+="),");n++});m=f.trim(m).substring(0,m.length-1);m+=";";!0===a.consoleLog&&console.log(m);if("string"==a.outputMode)return m;if("base64"==a.outputMode)return y(m);try{w=new Blob([m],{type:"text/plain;charset=utf-8"}),saveAs(w,a.fileName+".sql")}catch(Q){z(a.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(m))}}else if("json"==a.type){var J=[];f(this).find("thead").first().find(a.theadSelector).each(function(){var a=
[];u(this,"th,td",n,function(e,d,g){a.push(v(e,d,g))});J.push(a)});var K=[];f(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=[];u(this,"td",n,function(e,d,g){a.push(v(e,d,g))});0<a.length&&(1!=a.length||""!=a[0])&&K.push(a);n++});t=[];t.push({header:J,data:K});var b=JSON.stringify(t);!0===a.consoleLog&&console.log(b);if("string"==a.outputMode)return b;t=y(b);if("base64"==a.outputMode)return t;try{w=new Blob([b],{type:"application/json;charset=utf-8"}),saveAs(w,a.fileName+
".json")}catch(R){z(a.fileName+".json","data:application/json;charset=utf-8;base64,"+t)}}else if("xml"===a.type){var n=0,q='<?xml version="1.0" encoding="utf-8"?>',q=q+"<tabledata><fields>";f(this).find("thead").first().find(a.theadSelector).each(function(){u(this,"th,td",n,function(a,e,d){q+="<field>"+v(a,e,d)+"</field>"});n++});var q=q+"</fields><data>",E=1;f(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=1,e="";u(this,"td",n,function(d,g,b){e+="<column-"+a+">"+v(d,g,b)+
"</column-"+a+">";a++});"<column-1></column-1>"!=e&&(q+='<row id="'+E+'">'+e+"</row>",E++);n++});q+="</data></tabledata>";!0===a.consoleLog&&console.log(q);if("string"==a.outputMode)return q;t=y(q);if("base64"==a.outputMode)return t;try{w=new Blob([q],{type:"application/xml;charset=utf-8"}),saveAs(w,a.fileName+".xml")}catch(S){z(a.fileName+".xml","data:application/xml;charset=utf-8;base64,"+t)}}else if("excel"==a.type||"doc"==a.type){var n=0,h="<table>";f(this).find("thead").first().find(a.theadSelector).each(function(){h+=
"<tr>";u(this,"th,td",n,function(b,e,d){if(null!=b){h+="<td style='";for(var g in a.excelstyles)a.excelstyles.hasOwnProperty(g)&&(h+=a.excelstyles[g]+": "+f(b).css(a.excelstyles[g])+";");h+="'>"+v(b,e,d)+"</td>"}});n++;h+="</tr>"});E=1;f(this).find("tbody").first().find(a.tbodySelector).each(function(){h+="<tr>";u(this,"td",n,function(b,e,d){if(null!=b){h+="<td style='";for(var g in a.excelstyles)a.excelstyles.hasOwnProperty(g)&&(h+=a.excelstyles[g]+": "+f(b).css(a.excelstyles[g])+";");f(b).is("[colspan]")&&
(h+="' colspan='"+f(b).attr("colspan"));f(b).is("[rowspan]")&&(h+="' rowspan='"+f(b).attr("rowspan"));h+="'>"+v(b,e,d)+"</td>"}});E++;n++;h+="</tr>"});a.displayTableName&&(h+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+v(f("<p>"+a.tableName+"</p>"))+"</td></tr>");h+="</table>";!0===a.consoleLog&&console.log(h);b="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+a.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";b+='<meta http-equiv="content-type" content="application/vnd.ms-'+
a.type+'; charset=UTF-8">';b=b+'<meta http-equiv="content-type" content="application/'+("excel"===a.type?"vnd.ms-excel":"msword");b+='; charset=UTF-8">';b+="<head>";"excel"===a.type&&(b+="\x3c!--[if gte mso 9]>",b+="<xml>",b+="<x:ExcelWorkbook>",b+="<x:ExcelWorksheets>",b+="<x:ExcelWorksheet>",b+="<x:Name>",b+=a.worksheetName,b+="</x:Name>",b+="<x:WorksheetOptions>",b+="<x:DisplayGridlines/>",b+="</x:WorksheetOptions>",b+="</x:ExcelWorksheet>",b+="</x:ExcelWorksheets>",b+="</x:ExcelWorkbook>",b+=
"</xml>",b+="<![endif]--\x3e");b+="</head>";b+="<body>";b+=h;b+="</body>";b+="</html>";if("string"==a.outputMode)return b;t=y(b);if("base64"===a.outputMode)return t;var L="excel"===a.type?"xls":"doc";try{w=new Blob([b],{type:"application/vnd.ms-"+a.type}),saveAs(w,a.fileName+"."+L)}catch(T){z(a.fileName+"."+L,"data:application/vnd.ms-"+a.type+";base64,"+t)}}else if("png"==a.type)html2canvas(f(this),{onrendered:function(b){b=b.toDataURL();b=b.substring(22);for(var e=atob(b),d=new ArrayBuffer(e.length),
g=new Uint8Array(d),f=0;f<e.length;f++)g[f]=e.charCodeAt(f);try{var h=new Blob([d],{type:"image/png"});saveAs(h,a.fileName+".png")}catch(m){z(a.fileName+".png","data:image/png;base64,"+b)}}});else if("pdf"==a.type)if(!1===a.jspdf.autotable){var w={dim:{w:G(f(this).first().get(0),"width","mm"),h:G(f(this).first().get(0),"height","mm")},pagesplit:!1},M=new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);M.addHTML(f(this).first(),a.jspdf.margins.left,a.jspdf.margins.top,w,function(){H(M)})}else{var l=
a.jspdf.autotable.tableExport;if("string"===typeof a.jspdf.format&&"bestfit"===a.jspdf.format.toLowerCase()){var B={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},F="",C="",N=0;f(this).filter(":visible").each(function(){if("none"!=f(this).css("display")){var a=G(f(this).get(0),"width","pt");if(a>N){a>B.a0[0]&&(F="a0",C="l");for(var b in B)B.hasOwnProperty(b)&&B[b][1]>a&&(F=b,C="l",B[b][0]>a&&(C="p"));N=a}}});a.jspdf.format=""==F?"a4":F;a.jspdf.orientation=
""==C?"w":C}l.doc=new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);f(this).filter(":visible").each(function(){if("none"!=f(this).css("display")){var b,e=0,d={};l.columns=[];l.rows=[];l.rowoptions={};if("function"===typeof l.onTable&&!1===l.onTable(f(this),a))return!0;Object.keys(a.jspdf.autotable).forEach(function(b){d[b]=a.jspdf.autotable[b]});d.margins={};f.extend(!0,d.margins,a.jspdf.margins);"function"!==typeof d.renderCell&&(d.renderCell=function(a,b,e,d,f,h,m,k){var l=k.tableExport.doc,
n=0;l.setFillColor(0===m%2?245:255);l.setTextColor(50);l.rect(a,b,e,d,"F");b+=k.lineHeight/2+l.autoTableTextHeight()/2-2.5;"undefined"!=typeof k.tableExport.columns[f]&&(d=k.tableExport.columns[f].style.align,f=k.tableExport.rowoptions[m+1+":"+f],void 0!==f&&(d=f.style.align),"right"==d?n=e-l.getStringUnitWidth(""+h)*l.internal.getFontSize()-k.padding:"center"==d&&(n=(e-l.getStringUnitWidth(""+h)*l.internal.getFontSize())/2));n<k.padding&&(n=k.padding);l.text(h,a+n,b)});f(this).find("thead").find(a.theadSelector).each(function(){b=
0;u(this,"th,td",e,function(a,d,e){a={title:v(a,d,e),key:b++,style:{align:A(a,"text-align"),bcolor:A(a,"background-color")}};l.columns.push(a)});e++});f(this).find("tbody").find(a.tbodySelector).each(function(){var a=[];b=0;u(this,"td",e,function(d,f,h){var m={style:{align:A(d,"text-align"),bcolor:A(d,"background-color")}};l.rowoptions[e+":"+b++]=m;a.push(v(d,f,h))});e++;l.rows.push(a)});if("function"===typeof l.onBeforeAutotable)l.onBeforeAutotable(f(this),l.columns,l.rows,d);l.doc.autoTable(l.columns,
l.rows,d);if("function"===typeof l.onAfterAutotable)l.onAfterAutotable(f(this),d);a.jspdf.autotable.startY=l.doc.autoTableEndPosY()+d.margins.top}});H(l.doc);l.columns.length=0;l.rows.length=0;delete l.doc;l.doc=null}return this}})})(jQuery);
